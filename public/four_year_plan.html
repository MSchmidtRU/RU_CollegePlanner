<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAPS - Four Year Plan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        header {
            background-color: #CC0033;
            color: #fff;
            padding: 20px 0;
            text-align: center;
        }

        .header-content {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .header-content img {
            height: 50px;
            /* Adjust height as needed */
            margin-right: 10px;
        }

        nav {
            background-color: #f0f0f0;
            padding: 10px 0;
            text-align: center;
        }

        nav a {
            text-decoration: none;
            color: #CC0033;
            margin: 0 15px;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        nav a:hover {
            color: #fff;
            background-color: #CC0033;
            border-radius: 5px;
        }

        section {
            padding: 50px 20px;
            text-align: center;
        }

        footer {
            background-color: #CC0033;
            color: #fff;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        button {
            background-color: #CC0033;
            color: #fff;
            border: none;
            padding: 10px 20px;
            margin-top: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #990022;
        }

        .semester-box {
            width: 200px;
            padding: 10px;
            margin: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            position: relative;
        }

        .semester-title {
            background-color: #CC0033;
            color: white;
            padding: 5px;
            text-align: center;
            border-radius: 5px 5px 0 0;
        }

        .courses-list {
            padding: 10px;
            list-style-type: none;
            margin: 0;
        }

        .courses-list li {
            margin-bottom: 5px;
        }

        .unused-course {
            color: #CC0033;
            cursor: Pointer;
        }

        .fulfilled-course {
            color: green;
            cursor: Pointer;
        }

        .tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px;
            border-radius: 5px;
            z-index: 1;
            visibility: hidden;
        }

        .semester-box:hover .tooltip {
            visibility: visible;
        }

        .selected-course {
            background-color: #CC0033;
            color: white;
        }

        .courses-list li:hover {
            background-color: lightgray;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            /* margin: 5% auto; */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;

            max-width: 80%;
            margin: 0 auto;
        }

        .modal-content label {
            display: block;
            margin-bottom: 10px;
        }

        .modal-content input[type="radio"] {
            margin-right: 5px;
        }

        .modal-content input[type="submit"] {
            background-color: #CC0033;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #CC0033;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .sections-container {
            display: flex;
            justify-content: space-between;
        }

        .info-section {
            width: 33.33%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            position: relative;
        }


        /* Style for the overall validation status */
        .info-section h3 {
            font-size: 1.2em;
            /* Adjust font size as needed */
            margin-bottom: 10px;
            /* Adjust spacing between heading and text as needed */
        }

        /* Style for the status text */
        .info-section p {
            font-size: 1em;
            /* Adjust font size as needed */
            margin: 0;
            /* Remove default margin */
        }

        /* Style for the missing requirements lists */
        .info-section div {
            margin-top: 10px;
            /* Adjust spacing between heading and list as needed */
        }

        /* Style for individual list items */
        .info-section div p {
            margin: 5px 0;
            /* Adjust spacing between list items as needed */
        }

        .context-menu {
            display: none;
            position: absolute;
            background-color: #ccc;
            border: 1px solid #ccc;
            padding: 5px;
            z-index: 1000;
        }

        .close {
            position: absolute;
            top: 15px;
            left: 20px;
            color: #fff;
            font-size: 25px;
            font-weight: bold;
            padding: 5px;
            background-color: #000;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
        }

        .context-menu ul {
            list-style: none;
            /* Remove bullet points */
            padding: 0;
            margin: 0;
        }

        .context-menu li {
            margin-bottom: 5px;
        }

        .context-menu li a {
            display: block;
            text-decoration: none;
            color: #333;
            padding: 8px 15px;
            background-color: #ccc;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .context-menu li a:hover {
            background-color: #cc0033;
            /* Rutgers red */
            color: #fff;
        }
    </style>
</head>

<body>

    <header>
        <h1>MAPS - Four Year Plan</h1>
    </header>

    <nav>
        <a href="index.html">Home</a>
        <a href="ccwebpage.html">Course Catalog</a>
        <a href="four_year_plan.html">4 Year Plan</a>
        <a href="csearch.html">Concentration Search</a>
        <a href="concentrationRequest.html">Request Concentration Switch or Declaration</a>
        <a href="academicStatus.html"> View Academic Status</a>
      </nav>
    <div class="spinner" id="spinner"></div>
    <section id="plan-section">
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2>Select Stable Courses</h2>
                <!-- Radio options for optimization strategy -->
                <label>
                    <input type="radio" id="quickestRadio" name="optimizationStrategy" value="quickest" checked>
                    Quickest
                </label>
                <label>
                    <input type="radio" id="balancedRadio" name="optimizationStrategy" value="balanced">
                    Balanced
                </label>
                <!-- Course boxes -->
                <div id="course-boxes" style="display: flex; flex-wrap: wrap; justify-content: center;"></div>
                <input type="submit" id="submitStableCourses" value="OK">
            </div>
        </div>

        <div id="validationModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeValidationModal()">&times;</span>
                <div id="validationInfoContent">
                    <!-- Validation information will be displayed here -->
                    <div class="sections-container">
                        <div class="info-section">
                            <h3>Prerequisites and Corequisites:</h3>
                            <p id="prereqCoreqStatus"></p>
                        </div>
                        <div class="info-section">
                            <h3>Concentration Requirements:</h3>
                            <p id="concentrationStatus"></p>
                        </div>
                        <div class="info-section">
                            <h3>Residency Requirements:</h3>
                            <p id="residencyStatus"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="plan-heading">
            <h2>Your Four Year Plan</h2>
            <!-- Alert and success icons will be appended here -->
        </div>

        <!-- Content for Four Year Plan section -->
        <div id="plan" style="display: flex; flex-wrap: wrap; justify-content: center;"></div>

        <div id="contextMenu" class="context-menu">
            <ul>
                <li><a href="#" onclick="removeCourseFromMenu()">Remove Course</a></li>
                <li><a href="#" onclick="changeSemester()">Change Semester</a></li>
            </ul>
        </div>

        <button id="validateBtn">Validate</button>
        <button id="optimizeBtn">Optimize</button>
        <button id="addCourse">Add Course</button>
        <button id="keepOldBtn" style="display: none;">Keep Old Plan</button>
        <button id="saveBtn" style="display: none;">Save</button>
        <button id="viewValidateInfo" style="display: none;">View Validation Info</button>
        <button id="revalidate" style="display: none;">Revalidate</button>
        <button id="clearValidationInfo" style="display: none;">Clear</button>


    </section>

    <footer>
        <p>&copy; 2024 MAPS - My Academic Planning System. All rights reserved.</p>
    </footer>

    <script>
        var fourYearPlan;
        var validationData;
        var stableCourses = [];
        var optimizedPlan = [];
        var optimizedClicked = false;

        function showSpinner() {
            document.getElementById('spinner').style.display = 'block';
            document.getElementById('plan-section').style.display = 'none';
        }

        // Function to hide the spinner
        function hideSpinner() {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('plan-section').style.display = 'block';

        }
        function sendRequest(method, url, data = undefined) {
           
            var mockToken = localStorage.getItem('mockToken');
            showSpinner();
            return new Promise(function (resolve, reject) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        if (this.status == 200 || this.status == 201) {
                            var response = this.responseText;
                            console.log(response);
                            resolve(response); // Resolve with the response
                            hideSpinner();
                        } else {
                            // Parse the error message from the server
                            var errorMessage = '';
                            if (this.responseText) {
                                try {
                                    var errorResponse = JSON.parse(this.responseText);
                                    errorMessage = errorResponse.message || 'Request failed';
                                } catch (error) {
                                    errorMessage = 'Request failed';
                                }
                            } else {
                                errorMessage = 'Request failed';
                            }
                            errorMessage += ' (Status code: ' + this.status + ')';

                            hideSpinner(); // Hide the spinner before showing the alert
                            reject(new Error(errorMessage)); // Reject with an error containing the error message
                            alert(errorMessage); // Display the error message in an alert
                        }
                    }
                };

                xhttp.open(method, url, true);
                xhttp.setRequestHeader('authorization', `Bearer ${mockToken}`);
                if (data != undefined) {
                    xhttp.setRequestHeader('Content-Type', 'application/json');
                }
                data == undefined ? xhttp.send() : xhttp.send(data);
            });
        }

        document.addEventListener('DOMContentLoaded', async function () {
            plan = await sendRequest("GET", "http://127.0.0.1:3000/4yrplan");
            fourYearPlan = JSON.parse(plan);
            displayFourYearPlan(fourYearPlan)
        });

        // Function to display the retrieved four year plan on the page
        function displayFourYearPlan(res) {
            plan = res;
            var schedule = {
                0: [], // Freshman Fall
                1: [], // Freshman Spring
                2: [], // Sophomore Fall
                3: [], // Sophomore Spring
                4: [], // Junior Fall
                5: [], // Junior Spring
                6: [], // Senior Fall
                7: []  // Senior Spring
            };
            plan.forEach(function (course) {
                schedule[course.semester].push(course.course);
            });

            // Display schedule in HTML
            var scheduleContainer = document.getElementById('plan');
            scheduleContainer.innerHTML = '';

            for (var semester = 0; semester <= 7; semester++) {
                var semesterBox = document.createElement('div');
                semesterBox.classList.add('semester-box');

                var semesterTitle = document.createElement('div');
                semesterTitle.classList.add('semester-title');
                semesterTitle.textContent = getSemesterName(semester);
                semesterBox.appendChild(semesterTitle);

                var coursesList = document.createElement('ul');
                coursesList.classList.add('courses-list');
                schedule[semester].forEach(function (course) {
                    var courseItem = document.createElement('li');
                    courseItem.textContent = course;
                    courseItem.addEventListener('contextmenu', function (event) {
                        event.preventDefault();
                        showContextMenu(event, course);
                    });
                    coursesList.appendChild(courseItem);
                });
                semesterBox.appendChild(coursesList);

                scheduleContainer.appendChild(semesterBox);
            }
        }


        function getSemesterName(semester) {
            switch (semester) {
                case 0: return 'Freshman Fall';
                case 1: return 'Freshman Spring';
                case 2: return 'Sophomore Fall';
                case 3: return 'Sophomore Spring';
                case 4: return 'Junior Fall';
                case 5: return 'Junior Spring';
                case 6: return 'Senior Fall';
                case 7: return 'Senior Spring';
                default: return 'Unknown';
            }
        }

        // Function to send request to validate the four year plan
        async function validate() {
            var userInput = prompt("Enter a concentration ID for validation:");
            validationData = JSON.parse(await sendRequest("GET", "http://127.0.0.1:3000/4yrplan/validate?concentrationID=" + userInput));
            validationResponse(validationData);
        }

        function validationResponse(res) {
            var responseData = res;

            // Check if any prerequisite errors or corequisite errors exist
            var hasPrereqErrors = Object.keys(responseData.validatePreCoReqs.prereqErrors).length > 0;
            var hasCoreqErrors = Object.keys(responseData.validatePreCoReqs.coreqErrors).length > 0;

            // Check if concentration courses are fulfilled
            var isConcentrationFulfilled = responseData.validateConcentrationCourses.isFulfilledConcentationCourses;

            // Check if residency requirements are met
            var isValidResidency = responseData.validateResidency.isValidResReq;

            // Get unassigned courses and number of missing residency requirements
            var unassignedCourses = responseData.validateConcentrationCourses.unassignedCourses;
            var numMissingResReq = responseData.validateResidency.numMissing;

            // Highlight unused course IDs in red with tooltip
            var unusedCourseIDs = responseData.validateConcentrationCourses.unusedIds;
            unusedCourseIDs.forEach(function (course) {
                var courseElements = document.querySelectorAll('.courses-list li');
                courseElements.forEach(function (element) {
                    if (element.textContent === course.course) {
                        element.classList.add('unused-course');
                        element.title = 'Course not being used';
                    }
                });
            });

            // Highlight fulfilled concentration courses in green with tooltip
            var refinedMap = responseData.validateConcentrationCourses.refinedMap;
            for (var key in refinedMap) {
                if (refinedMap.hasOwnProperty(key)) {
                    var fulfilledCourseID = refinedMap[key].course;
                    var semester = refinedMap[key].semester;
                    var courseElements = document.querySelectorAll('.courses-list li');
                    courseElements.forEach(function (element) {
                        if (element.textContent === fulfilledCourseID) {
                            element.classList.add('fulfilled-course');
                            element.title = 'Fulfills requirement: ' + key;
                        }
                    });
                }
            }
            showValidateInfoButtons();
        }


        function showModal() {
            document.getElementById('myModal').style.display = 'block';
        }

        // Function to close the modal
        function closeModal() {
            document.getElementById('myModal').style.display = 'none';
        }

        async function optimize() {
            stableCourses = [];
            var { courses, strategy } = await getOptimizeSettings();
            var coursesWithStableSemesters = JSON.parse(JSON.stringify(fourYearPlan));

            coursesWithStableSemesters.forEach(function (course) {
                if (!courses.includes(course.course)) {
                    course.semester = -1;
                }
            });
            optimizedPlan = JSON.parse(await sendRequest("POST", "http://127.0.0.1:3000/4yrplan/optimize?method=" + strategy, JSON.stringify({ "futureCourses": coursesWithStableSemesters })));

            modifiedPlan = [];
            for (var key in optimizedPlan) {
                if (optimizedPlan.hasOwnProperty(key)) {
                    modifiedPlan.push({ course: optimizedPlan[key].courseID, semester: optimizedPlan[key].semester });
                }
            }

            displayFourYearPlan(modifiedPlan);
            handleButtonDisplay(); // Handle button display after optimization
        }

        async function getOptimizeSettings() {
            showModal(); // Show the modal

            optimizedClicked = true;

            // Retrieve the course boxes and populate them
            var courseBoxesContainer = document.getElementById('course-boxes');
            courseBoxesContainer.innerHTML = ''; // Clear existing content

            // Iterate over the four-year plan and create course boxes
            for (var semester = 0; semester <= 7; semester++) {
                var semesterBox = document.createElement('div');
                semesterBox.classList.add('semester-box');

                var semesterTitle = document.createElement('div');
                semesterTitle.classList.add('semester-title');
                semesterTitle.textContent = getSemesterName(semester); // Get semester name
                semesterBox.appendChild(semesterTitle);

                // Create a list for courses in the semester
                var coursesList = document.createElement('ul');
                coursesList.classList.add('courses-list');
                fourYearPlan.forEach(function (course) {
                    if (course.semester === semester) {
                        var courseItem = document.createElement('li');
                        courseItem.textContent = course.course;
                        // Add click event to select the course
                        courseItem.addEventListener('click', function () {
                            handleCourseClick(courseItem);
                        });
                        coursesList.appendChild(courseItem);
                    }
                });
                semesterBox.appendChild(coursesList);

                courseBoxesContainer.appendChild(semesterBox);
            }

            // Return a promise to handle the "OK" button click
            return new Promise(function (resolve, reject) {
                document.getElementById('submitStableCourses').addEventListener('click', function () {
                    // Resolve with the stable courses array
                    var strategy = document.querySelector('input[name="optimizationStrategy"]:checked').value;

                    resolve({ courses: stableCourses, strategy: strategy });
                    closeModal(); // Close the modal
                });
            });
        }

        function handleCourseClick(courseItem) {
            var courseName = courseItem.textContent.trim();
            var semesterName = courseItem.closest('.semester-box').querySelector('.semester-title').textContent.trim();
            var index = stableCourses.findIndex(function (c) {
                return c.course === courseName;
            });
            if (index === -1) {
                // Add the course to the stable courses array
                stableCourses.push(courseName);
                // Highlight the selected course in red
                courseItem.classList.add('selected-course');
            } else {
                // Remove the course from the stable courses array
                stableCourses.splice(index, 1);
                // Remove the red highlight from the course
                courseItem.classList.remove('selected-course');
            }
        }

        async function saveSchedule() {
            var response = await sendRequest("PUT", "http://127.0.0.1:3000/4yrplan/save", JSON.stringify(optimizedPlan));

            document.getElementById('saveBtn').style.display = 'none';
            document.getElementById('keepOldBtn').style.display = 'none';

            showMainMenuButtons();
        }


        function handleButtonDisplay() {
            hideMainMenuButtons();

            document.getElementById('keepOldBtn').style.display = 'inline-block';
            document.getElementById('saveBtn').style.display = 'inline-block';
        }

        // Function to handle the revert to original schedule
        function keepOldSchedule() {
            displayFourYearPlan(fourYearPlan); // Revert to original schedule
            // Hide the Save and Keep Old buttons
            document.getElementById('keepOldBtn').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'none';

            showMainMenuButtons();
        }

        function showValidateInfoButtons() {
            hideMainMenuButtons();

            document.getElementById('viewValidateInfo').style.display = 'inline-block';
            document.getElementById('revalidate').style.display = 'inline-block';
            document.getElementById('clearValidationInfo').style.display = 'inline-block';
        }


        function showValidationInfo() {
            var validationInfoContent = document.getElementById('validationInfoContent');
            // // Clear previous content
            validationInfoContent.innerHTML = '';

            var precoreqStatus = validationData.validatePreCoReqs.isValidOrder;

            var concentrationStatus = validationData.validateConcentrationCourses.isFulfilledConcentationCourses;

            var residencyStatus = validationData.validateResidency.isValidResReq;

            var overallStatusText = document.createElement('h3');
            overallStatusText.textContent = `Overall Validation Status: ${validationData.validatePreCoReqs.isValidOrder &&
                validationData.validateConcentrationCourses.isFulfilledConcentationCourses &&
                validationData.validateResidency.isValidResReq ? 'Validated' : 'Invalid'}`;
            overallStatusText.style.color = validationData.validatePreCoReqs.isValidOrder &&
                validationData.validateConcentrationCourses.isFulfilledConcentationCourses &&
                validationData.validateResidency.isValidResReq ? 'green' : '#CC0033';

            validationInfoContent.appendChild(overallStatusText);

            var section = document.createElement('div');
            section.classList.add('sections-container');
            validationInfoContent.appendChild(section);

            //PRECOREQ SECTION
            var prereqCoreqContainer = document.createElement('div');
            prereqCoreqContainer.classList.add('info-section');
            section.appendChild(prereqCoreqContainer);

            var prereqCoreqStatus = document.createElement('h4');
            prereqCoreqStatus.textContent = 'Prerequisites and Corequisites:';
            prereqCoreqContainer.appendChild(prereqCoreqStatus);

            var prereqCoreqStatusText = document.createElement('h4');
            prereqCoreqStatusText.textContent = `Status: ${precoreqStatus ? 'Valid' : 'Invalid'}`;
            prereqCoreqStatusText.style.color = precoreqStatus ? 'green' : '#CC0033';
            prereqCoreqContainer.appendChild(prereqCoreqStatusText);

            if (!precoreqStatus) {
                var prereqList = document.createElement('div');
                prereqList.innerHTML = '<h4>Missing Prerequisites</h4>';
                var missingPrereqs = validationData.validatePreCoReqs.prereqErrors;
                for (var prereq in missingPrereqs) {
                    if (missingPrereqs.hasOwnProperty(prereq)) {
                        var prereqItem = document.createElement('div');
                        prereqItem.innerHTML = '<strong>' + prereq + ':</strong> ' + missingPrereqs[prereq].join(', ');
                        prereqList.appendChild(prereqItem);
                    }
                }
                var coreqList = document.createElement('div');
                coreqList.innerHTML = '<h4>Missing corequisites</h4>';
                var missingCoreqs = validationData.validatePreCoReqs.coreqErrors;
                for (var coreq in missingCoreqs) {
                    if (missingCoreqs.hasOwnProperty(coreq)) {
                        var coreqItem = document.createElement('p');
                        coreqItem.innerHTML = '<strong>' + coreq + ':</strong> ' + missingCoreqs[coreq].join(', ');
                        coreqList.appendChild(coreqItem);
                    }
                }
                prereqCoreqContainer.appendChild(prereqList);
                prereqCoreqContainer.appendChild(coreqList);
            } else {
                var noIssue = document.createElement('h4');
                var spacer = document.createElement('div');
                noIssue.textContent = "All Corequisites and Prerequiests comply with buisness policies";
                prereqCoreqContainer.appendChild(spacer);
                prereqCoreqContainer.appendChild(noIssue);
            }


            //CONCENTRATION SECTION
            var concentrationContainer = document.createElement('div');
            concentrationContainer.classList.add('info-section');
            section.appendChild(concentrationContainer);

            var concentrationStatusElement = document.createElement('h4');
            concentrationStatusElement.textContent = 'Concentration Requirements:';
            concentrationContainer.appendChild(concentrationStatusElement);

            var concentrationStatusText = document.createElement('p');
            concentrationStatusText.textContent = `Status: ${concentrationStatus ? 'Fulfilled' : 'Missing'}`;
            concentrationStatusText.style.color = concentrationStatus ? 'green' : '#CC0033';
            concentrationContainer.appendChild(concentrationStatusText);

            // Add missing concentration requirements, if any
            if (!concentrationStatus) {
                if (validationData.validateConcentrationCourses.unassignedCourses.length > 0) {
                    var concentrationList = document.createElement('div');
                    concentrationList.innerHTML = '<h4>Missing Concentration Requirements:</h4>';
                    for (var course of validationData.validateConcentrationCourses.unassignedCourses) {
                        var unassignedCourse = document.createElement('div');
                        var button = document.createElement('button');
                        button.textContent = 'Add';
                        button.style.padding = '5px 10px';
                        button.style.borderRadius = '5px';
                        button.style.fontSize = '12px';
                        button.style.margin = 'auto';
                        button.addEventListener('click', (function (courseCopy) {
                            return function () {
                                addCourseAfterValidation(courseCopy);
                            }
                        })(course));
                        var space = document.createElement('span');
                        space.textContent = ' ';
                        unassignedCourse.textContent = course;
                        unassignedCourse.style.color = '#CC0033';
                        unassignedCourse.appendChild(space);
                        unassignedCourse.appendChild(button);

                        concentrationList.appendChild(unassignedCourse);

                    }
                }

                if (validationData.validateConcentrationCourses.unusedIds.length > 0) {
                    var unusedIdsList = document.createElement('div');
                    unusedIdsList.innerHTML = '<h4>Unused IDs:</h4>';
                    for (var course of validationData.validateConcentrationCourses.unusedIds) {
                        var unusedID = document.createElement('p');
                        var button = document.createElement('button');
                        button.textContent = 'Remove';
                        button.style.padding = '5px 10px';
                        button.style.borderRadius = '5px';
                        button.style.fontSize = '12px';
                        button.style.margin = 'auto';
                        button.addEventListener('click', (function (courseCopy) {
                            return function () {
                                removeCourse(courseCopy);
                            }
                        })(course.course));
                        var space = document.createElement('span');
                        space.textContent = ' ';
                        unusedID.textContent = course.course;
                        unusedID.style.color = '#CC0033';
                        unusedID.style.cursor = 'context-menu';

                        unusedIdsList.appendChild(unusedID);
                        unusedIdsList.appendChild(space);
                        unusedIdsList.appendChild(button);
                    }
                }

                if (concentrationList) {
                    concentrationContainer.appendChild(concentrationList);
                } else {
                    var concentraionFulfilled = document.createElement('p');
                    var spacer = document.createElement('div');
                    var text = document.createElement('p');
                    concentraionFulfilled.innerHTML = '<h4>Missing Concentration Requirements:</h4>';
                    text.textContent = "all concentration requirments fulfilled";
                    concentraionFulfilled.appendChild(text);
                    concentrationContainer.appendChild(spacer);
                    concentrationContainer.appendChild(concentraionFulfilled);
                }
                if (unusedIdsList) {
                    concentrationContainer.appendChild(unusedIdsList);
                } else {
                    var noUnusedIDs = document.createElement('p');
                    var spacer = document.createElement('div');
                    noUnusedIDs.innerHTML = '<h4>Unused IDs:</h4>';
                    var text = document.createElement('p');
                    text.textContent = "no extra courses";
                    noUnusedIDs.appendChild(text);
                    concentrationContainer.appendChild(spacer);
                    concentrationContainer.appendChild(noUnusedIDs)
                }
            }


            //RESIDENCY SECTION
            var residencyContainer = document.createElement('div');
            residencyContainer.classList.add('info-section');
            section.appendChild(residencyContainer);

            var residencyStatus = document.createElement('h4');
            residencyStatus.textContent = 'Residency Requirements:';
            residencyContainer.appendChild(residencyStatus);

            var residencyStatusText = document.createElement('p');
            residencyStatusText.textContent = `Status: ${residencyStatus ? 'Fullfilled' : 'Missing'}`;
            residencyStatusText.style.color = residencyStatus ? 'green' : '#CC0033';
            residencyContainer.appendChild(residencyStatusText);

            var spacer = document.createElement('div');
            residencyContainer.appendChild(spacer);
            var numMissing = document.createElement('p');
            numMissing.textContent = 'Number of Missing Credits: ' + validationData.validateResidency.numMissing;
            residencyContainer.appendChild(numMissing);

            // Open the modal
            document.getElementById('validationModal').style.display = 'block';
        }

        function closeValidationModal() {
            document.getElementById('validationModal').style.display = 'none';
        }

        // Function to clear validation and revert to original plan
        function clearValidation() {
            displayFourYearPlan(fourYearPlan);
            document.getElementById('viewValidateInfo').style.display = 'none';
            document.getElementById('revalidate').style.display = 'none';
            document.getElementById('clearValidationInfo').style.display = 'none';

            showMainMenuButtons()
        }

        async function removeCourseFromMenu() {
            var courseId = document.getElementById('contextMenu').getAttribute('data-course-id');
            await removeCourse(courseId);
        }

        async function removeCourse(courseId) {
            updated4YearPlan = JSON.parse(await sendRequest("DELETE", "http://127.0.0.1:3000/4yrplan/course", JSON.stringify({ 'courseID': courseId })));
            fourYearPlan = updated4YearPlan;
            displayFourYearPlan(updated4YearPlan);
        }

        function showContextMenu(event, courseId) {
            var contextMenu = document.getElementById('contextMenu');
            contextMenu.style.left = event.pageX + 'px';
            contextMenu.style.top = event.pageY + 'px';
            contextMenu.style.display = 'block';

            // Store the courseId in a data attribute for later use
            contextMenu.setAttribute('data-course-id', courseId);

            document.addEventListener('click', function hideContextMenu() {
                contextMenu.style.display = 'none';
                document.removeEventListener('click', hideContextMenu);
            });
        }

        async function changeSemester() {
            showSpinner();
            var semester = prompt('Enter the semester (0-7):');
            var courseId = document.getElementById('contextMenu').getAttribute('data-course-id');

            await removeCourse(courseId);
            showSpinner();
            await addCourse(courseId, semester);
        }

        function promptAddCourse() {
            var courseId = prompt('Enter the course ID:');
            if (courseId !== null) {
                courseId = courseId.trim(); // Trim any leading/trailing whitespaces
                var semesterIndex = prompt('Enter the semester (0-7):');
                if (semesterIndex !== null) {
                    semesterIndex = parseInt(semesterIndex);
                    if (!isNaN(semesterIndex) && semesterIndex >= 0 && semesterIndex <= 7) {
                        addCourse(courseId, semesterIndex);
                    } else {
                        alert("Invalid semester index. Please enter a number between 0 and 7.");
                    }
                }
            }
        }

        async function addCourseAfterValidation(courseId) {
            var semesterIndex = prompt('Enter the semester (0-7):');
            if (semesterIndex !== null) {
                semesterIndex = parseInt(semesterIndex);
                if (!isNaN(semesterIndex) && semesterIndex >= 0 && semesterIndex <= 7) {
                    await addCourse(courseId, semesterIndex);
                    alert(`${courseId} successfully added to plan`);
                } else {
                    alert("Invalid semester index. Please enter a number between 0 and 7.");
                }
            }
        }

        async function addCourse(courseId, semester) {
            if (semester < 0 || semester > 7) {
                alert("no way to add course to a valid semester");
                return;
            }
            updated4YearPlan = JSON.parse(await sendRequest("POST", "http://127.0.0.1:3000/4yrplan/course", JSON.stringify({ 'courseID': courseId, "semester": parseInt(semester) })));
            fourYearPlan = updated4YearPlan;
            displayFourYearPlan(updated4YearPlan);
        }

        function hideMainMenuButtons() {
            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('optimizeBtn').style.display = 'none';
            document.getElementById('addCourse').style.display = 'none';
        }

        function showMainMenuButtons() {
            document.getElementById('validateBtn').style.display = 'inline-block';
            document.getElementById('optimizeBtn').style.display = 'inline-block';
            document.getElementById('addCourse').style.display = 'inline-block';
        }

        function getCourseSemester(course) {
            const courseObj = fourYearPlan.find(c => c.course === course);
            return courseObj ? parseInt(courseObj.semester) : -1;
        }

        document.getElementById('optimizeBtn').addEventListener('click', optimize);
        document.getElementById('validateBtn').addEventListener('click', validate);
        document.getElementById('addCourse').addEventListener('click', promptAddCourse);
        document.getElementById('saveBtn').addEventListener('click', saveSchedule);
        document.getElementById('keepOldBtn').addEventListener('click', keepOldSchedule);
        document.getElementById('viewValidateInfo').addEventListener('click', showValidationInfo);
        document.getElementById('revalidate').addEventListener('click', validate);
        document.getElementById('clearValidationInfo').addEventListener('click', clearValidation);
    </script>

</body>

</html>